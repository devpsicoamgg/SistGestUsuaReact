// <script type="text/jsx">
function CreacionMercados() {
  const [form] = Form.useForm();
  const history = useHistory();
  const [productos, setProductos] = useState([]);

  // Función para guardar un producto
  const guardarProducto = (producto) => {
    google.script.run
      .withSuccessHandler(({ titulo, descripcion }) => {
        notificacionTareaTerminada(titulo, descripcion);
        form.resetFields();
        history.push('/welcome'); // Redirigir a la página deseada después de guardar
        listarProductos(); // Actualizar la lista de productos después de guardar
      })
      .guardarMercados(JSON.stringify(producto)); // Llamar a la función del backend con el producto JSON stringificado
  };

  // Función para listar productos
  const listarProductos = () => {
    google.script.run
      .withSuccessHandler((productos) => {
        setProductos(JSON.parse(productos));
      })
      .listarProductosMercados(); // Llamar a la función del backend para obtener productos
  };

  useEffect(() => {
    listarProductos(); // Cargar productos al montar el componente
  }, []);

  const handleSubmit = (values) => {
    const { nombreProducto, grupoAlimentario, presentacion, img } = values;
    const producto = {
      id: v4(), // Generar un ID único para el producto
      fechaCreacion: moment().format('YYYY-MM-DD'), // Fecha de creación del producto
      nombreProducto,
      grupoAlimentario,
      presentacion,
      img,
    };

    guardarProducto(producto); // Llamar a la función para guardar el producto
  };

  const columns = [
    {
      title: 'Nombre del Producto',
      dataIndex: 'nombreProducto',
      key: 'nombreProducto',
    },
    {
      title: 'Grupo Alimentario',
      dataIndex: 'grupoAlimentario',
      key: 'grupoAlimentario',
    },
    {
      title: 'Presentación',
      dataIndex: 'presentacion',
      key: 'presentacion',
    },
    {
      title: 'Fecha de Creación',
      dataIndex: 'fechaCreacion',
      key: 'fechaCreacion',
    },
    {
      title: 'Acciones',
      key: 'acciones',
      render: (text, record) => (
        <Button type="link" onClick={() => console.log(record)}>Detalles</Button> // Placeholder para acciones adicionales
      ),
    },
  ];

  return (
    <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'flex-start', marginTop: '6%' }}>
      {/* Formulario */}
      <div style={{ marginRight: '20px', width: '50%' }}>
        <Form
          form={form}
          onFinish={handleSubmit}
          layout="vertical"
          style={{ 
            width: '100%', 
            padding: '20px', 
            boxShadow: '0 4px 8px rgba(0, 0, 0, 0.1)', 
            borderRadius: '8px', 
            backgroundColor: '#C497E5', 
            color: '#333', 
            marginBottom: '20px',
            backgroundColor: '#E3F2FD' 
          }}
        >
          <h2 style={{ textAlign: 'center', marginBottom: '2rem' }}>Registro de Producto</h2>
  
          {/* Campos del formulario */}
          <Form.Item
            name="nombreProducto"
            label="Nombre del Producto"
            rules={[{ required: true, message: 'Por favor ingrese el nombre del producto' }]}
          >
            <Input placeholder="Nombre del Producto" />
          </Form.Item>
  
          <Form.Item
            name="grupoAlimentario"
            label="Grupo Alimentario"
            rules={[{ required: true, message: 'Por favor seleccione el grupo alimentario' }]}
          >
            <Select placeholder="Seleccione el Grupo Alimentario">
              <Select.Option value="CEREALES">CEREALES</Select.Option>
              <Select.Option value="RAICES, TUBÉRCULOS Y PLÁTANOS">RAICES, TUBÉRCULOS Y PLÁTANOS</Select.Option>
              <Select.Option value="FRUTAS & VERDURAS">FRUTAS & VERDURAS</Select.Option>
              <Select.Option value="CARNES, HUEVOS, PECES">CARNES, HUEVOS, PECES</Select.Option>
              <Select.Option value="LEGUMINOSAS, MEZCLAS VEGETALES">LEGUMINOSAS, MEZCLAS VEGETALES</Select.Option>
              <Select.Option value="LÁCTEOS & DERIVADOS">LÁCTEOS & DERIVADOS</Select.Option>
            </Select>
          </Form.Item>
  
          <Form.Item
            name="presentacion"
            label="Presentación"
            rules={[{ required: true, message: 'Por favor ingrese la presentación del producto' }]}
          >
            <Input placeholder="Presentación del Producto" />
          </Form.Item>
  
          <Form.Item
            name="img"
            label="Imagen (URL)"
            rules={[{ required: true, message: 'Por favor ingrese la URL de la imagen del producto' }]}
          >
            <Input placeholder="URL de la Imagen" />
          </Form.Item>
  
          <Form.Item style={{ textAlign: 'center' }}>
            <Button type="primary" htmlType="submit">
              Guardar Producto
            </Button>
          </Form.Item>
        </Form>
      </div>
  
      {/* Tabla de productos */}
      <div style={{ width: '50%', backgroundColor: '#66ff66', padding: '10px', boxShadow: '0 4px 8px rgba(0, 0, 0, 0.1)', borderRadius: '8px' }}>
        <Table
          columns={columns}
          dataSource={productos.map((producto, index) => ({
            ...producto,
            key: producto.id 
          }))}
          pagination={false}
          style={{ maxWidth: '100%' }}
        />
      </div>
    </div>
  );  
}  
// </script>
