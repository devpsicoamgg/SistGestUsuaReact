//<script type="text/jsx">

function Relaciones() {
  const [contractData, setContractData] = useState([]);
  const [gruposData, setGruposData] = useState([]);
  const [rrhhData, setRrhhData] = useState([]);
  const [searchTextContract, setSearchTextContract] = useState('');
  const [searchTextGrupos, setSearchTextGrupos] = useState('');
  const [searchTextrrhh, setSearchTextrrhh] = useState('');
  const history = useHistory();
  const Tooltip = window.antd.Tooltip;

  useEffect(() => {
    listarContratos();
    listarRRHH();
    listarGrupos();
  }, []);

  const formatFecha = (fecha) => {
    const date = new Date(fecha);
    const day = String(date.getDate()).padStart(2, '0');
    const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
    const month = monthNames[date.getMonth()];
    const year = date.getFullYear();
    return `${day}/${month}/${year}`;
  };

  const listarContratos = () => {
    notificacionObteniendoDatos("Obteniendo la informaci√≥n de contratos, RRHH y grupos desde el servidor");
    google.script.run
      .withSuccessHandler(res => {
        try {
          const contratos = JSON.parse(res);
          contratos.sort((a, b) => (a.nombreDelContrato > b.nombreDelContrato) ? 1 : -1);
          setContractData(contratos);
          Swal.close();
        } catch (error) {
          console.error('Error parsing JSON:', error);
          Swal.close();
        }
      })
      .listarContratos();
  };

  const listarRRHH = () => {
    notificacionObteniendoDatos("Obteniendo lista de RRHH desde el servidor");
    google.script.run
      .withSuccessHandler(res => {
        try {
          const rrhh = JSON.parse(res);
          rrhh.sort((a, b) => (a.nombreCompleto > b.nombreCompleto) ? 1 : -1);
          setRrhhData(rrhh);
          Swal.close();
        } catch (error) {
          console.error('Error parsing JSON:', error);
          Swal.close();
        }
      })
      .listarRRHH();
  };

  const listarGrupos = () => {
    notificacionObteniendoDatos("Obteniendo lista de grupos desde el servidor");
    google.script.run
      .withSuccessHandler(res => {
        try {
          const grupos = JSON.parse(res);
          grupos.sort((a, b) => (a.nombreGrupo > b.nombreGrupo) ? 1 : -1);
          setGruposData(grupos);
          Swal.close();
        } catch (error) {
          console.error('Error parsing JSON:', error);
          Swal.close();
        }
      })
      .listarGrupos();
  };

  const handleSearchContract = (value) => {
    setSearchTextContract(value);
    if (value === '') {
      listarContratos();
    } else {
      const filteredContracts = contractData.filter(contrato =>
        contrato.nombreDelContrato.toLowerCase().includes(value.toLowerCase())
      );
      setContractData(filteredContracts);
    }
  };

  const handleSearchGrupos = (value) => {
    setSearchTextGrupos(value);
    if (value === '') {
      listarGrupos();
    } else {
      const filteredGrupos = gruposData.filter(grupo =>
        grupo.groupName.toLowerCase().includes(value.toLowerCase())
      );
      setGruposData(filteredGrupos);
    }
  };

  const handleSearchRRHH = (value) => {
    setSearchTextrrhh(value);
    if (value === '') {
      listarRRHH();
    } else {
      const filteredRRHH = rrhhData.filter(rrhh =>
        rrhh.fullName.toLowerCase().includes(value.toLowerCase())
      );
      setRrhhData(filteredRRHH);
    }
  };

  const contractColumns = [
    {
      title: 'Nombre del Contrato',
      dataIndex: 'nombreDelContrato',
      key: 'nombreDelContrato',
    },
    {
      title: 'N√∫mero del Contrato',
      dataIndex: 'contractNumber',
      key: 'contractNumber',
    },
    {
      title: 'Fecha Creaci√≥n',
      dataIndex: 'fechaCreacion',
      key: 'fechaCreacion',
      render: (text, record) => formatFecha(record.fechaCreacion),
      
    },
  ];

  const gruposColumns = [
    {
      title: 'Nombre del Grupo',
      dataIndex: 'groupName',
      key: 'groupName',
    },
    {
      title: 'Fecha de Creaci√≥n',
      dataIndex: 'fechaCreacion',
      key: 'fechaCreacion',
      render: (text, record) => formatFecha(record.fechaCreacion),
    },
    {
      title: 'C√≥digo Cuentame',
      dataIndex: 'cuentameCode',
      key: 'cuentameCode',
    },
    {
      title: 'Acciones',
      key: 'acciones',
      render: (text, record) => (
        <div>
          {/* Aqu√≠ se pueden agregar acciones espec√≠ficas para grupos */}
        </div>
      ),
    },
  ];

  const rrhhColumns = [
    {
      title: 'Nombre Completo',
      dataIndex: 'fullName',
      key: 'fullName',
    },
    {
      title: 'Cargo',
      dataIndex: 'cargo',
      key: 'cargo',
    },
    {
      title: 'Acciones',
      key: 'acciones',
      render: (text, record) => (
        <div>
          {/* Aqu√≠ se pueden agregar acciones espec√≠ficas para RRHH */}
        </div>
      ),
    },
  ];

  return (
    <div className="flex flex-col items-center justify-center p-4 bg-gray-100 min-h-screen">
      <h2 className="font-bold text-2xl mb-4">ZONA DE RELACIONES</h2>
      <div className="w-full max-w-screen-lg flex flex-col gap-4">
        <Card 
          title="Contratos" 
          className="rounded" 
          style={{ backgroundColor: '#ffcccc' }} 
          extra={
            <Tooltip title="Buscar Contrato">
              <Input.Search
                placeholder="Buscar por nombre de contrato ‚úçüèΩ"
                value={searchTextContract}
                onChange={e => handleSearchContract(e.target.value)}
                className="flex-1 p-2 rounded border border-gray-300"
              />
            </Tooltip>
          }
        >
          <Table
            columns={contractColumns}
            dataSource={contractData.map((data, index) => ({ ...data, key: index }))}
            pagination={{ pageSize: 3 }}
          />
        </Card>

        <Card 
          title="Grupos" 
          className="rounded" 
          style={{ backgroundColor: '#ccffcc' }} 
          extra={
            <Tooltip title="Buscar Grupo">
              <Input.Search
                placeholder="Buscar por nombre de grupo ‚úçüèΩ"
                value={searchTextGrupos}
                onChange={e => handleSearchGrupos(e.target.value)}
                className="flex-1 p-2 rounded border border-gray-300"
              />
            </Tooltip>
          }
        >
          <Table
            columns={gruposColumns}
            dataSource={gruposData.map((data, index) => ({ ...data, key: index }))}
            pagination={{ pageSize: 3 }}
          />
        </Card>

        <Card 
          title="Talento Humano (RRHH)" 
          className="rounded" 
          style={{ backgroundColor: '#ccccff' }}
          extra={
            <Tooltip title="Buscar RRHH">
              <Input.Search
                placeholder="Buscar por nombre ‚úçüèΩ"
                value={searchTextrrhh}
                onChange={e => handleSearchRRHH(e.target.value)}
                className="flex-1 p-2 rounded border border-gray-300"
              />
            </Tooltip>
          }
        >
          <Table
            columns={rrhhColumns}
            dataSource={rrhhData.map((data, index) => ({ ...data, key: index }))}
            pagination={{ pageSize: 3 }}
          />
        </Card>
      </div>
    </div>
  );
}

//</script>
